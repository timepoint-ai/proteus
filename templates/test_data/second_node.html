{% extends "base.html" %}

{% block title %}Second Node Simulator - Clockchain Node Operator{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h1>Second Node Simulator</h1>
                <div class="btn-group">
                    <a href="{{ url_for('test_data.test_data_dashboard') }}" class="btn btn-outline-secondary">
                        <i class="fas fa-arrow-left me-2"></i>Back to Test Data
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Node Simulator Controls -->
    <div class="row mb-4">
        <div class="col-md-8 mx-auto">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-server me-2"></i>Simulate Additional Network Node
                    </h5>
                </div>
                <div class="card-body">
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        This simulator creates a second node operator to test distributed functionality,
                        consensus mechanisms, and network synchronization features.
                    </div>
                    
                    <form method="POST" action="{{ url_for('test_data.start_second_node') }}">
                        <div class="mb-3">
                            <h6>Node Configuration</h6>
                            <div class="row">
                                <div class="col-md-6">
                                    <label class="form-label">Node ID</label>
                                    <input type="text" class="form-control" value="simulator-node-002" readonly>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Node Type</label>
                                    <input type="text" class="form-control" value="validator" readonly>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <h6>Features to Test</h6>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" checked disabled>
                                        <label class="form-check-label">
                                            Consensus Voting
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" checked disabled>
                                        <label class="form-check-label">
                                            Stake Management
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" checked disabled>
                                        <label class="form-check-label">
                                            Oracle Submissions
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" checked disabled>
                                        <label class="form-check-label">
                                            Time Synchronization
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" checked disabled>
                                        <label class="form-check-label">
                                            Transaction Processing
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" checked disabled>
                                        <label class="form-check-label">
                                            Network Metrics
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-play me-2"></i>Start Second Node Simulator
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Node Status Display -->
    <div class="row">
        <div class="col-md-6 mb-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-desktop me-2"></i>Primary Node Status
                    </h5>
                </div>
                <div class="card-body">
                    <div id="primary-node-status">
                        <p class="text-muted">Loading node status...</p>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-6 mb-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-server me-2"></i>Simulator Node Status
                    </h5>
                </div>
                <div class="card-body">
                    <div id="simulator-node-status">
                        <p class="text-muted">Node not started</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Network Comparison -->
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-network-wired me-2"></i>Network Comparison
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="card bg-primary text-white">
                                <div class="card-body text-center">
                                    <h3 id="total-nodes">-</h3>
                                    <p class="mb-0">Total Nodes</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card bg-success text-white">
                                <div class="card-body text-center">
                                    <h3 id="active-nodes">-</h3>
                                    <p class="mb-0">Active Nodes</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card bg-info text-white">
                                <div class="card-body text-center">
                                    <h3 id="network-health">-</h3>
                                    <p class="mb-0">Network Health</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Simulation Log -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-list me-2"></i>Simulation Log
                    </h5>
                </div>
                <div class="card-body">
                    <div id="simulation-log" style="height: 200px; overflow-y: auto; background: #f8f9fa; padding: 10px; border-radius: 4px; font-family: monospace; font-size: 0.9em;">
                        <p class="text-muted">No simulation activity yet...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Load initial node status
    loadNodeStatus();
    
    // Auto-refresh every 10 seconds
    setInterval(loadNodeStatus, 10000);
    
    function loadNodeStatus() {
        // Load primary node status
        fetch('/test_data/api/node_status/default-node-001')
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    document.getElementById('primary-node-status').innerHTML = 
                        '<p class="text-danger">Error loading node status</p>';
                } else {
                    document.getElementById('primary-node-status').innerHTML = `
                        <div class="row">
                            <div class="col-6">
                                <strong>Status:</strong> <span class="badge bg-${data.status === 'active' ? 'success' : 'secondary'}">${data.status}</span>
                            </div>
                            <div class="col-6">
                                <strong>Reputation:</strong> ${data.reputation_score}
                            </div>
                            <div class="col-6 mt-2">
                                <strong>Stakes:</strong> ${data.total_stakes}
                            </div>
                            <div class="col-6 mt-2">
                                <strong>Transactions:</strong> ${data.total_transactions}
                            </div>
                        </div>
                    `;
                }
            })
            .catch(error => {
                console.error('Error loading primary node status:', error);
            });
        
        // Load simulator node status
        fetch('/test_data/api/node_status/simulator-node-002')
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    document.getElementById('simulator-node-status').innerHTML = 
                        '<p class="text-muted">Simulator node not started</p>';
                } else {
                    document.getElementById('simulator-node-status').innerHTML = `
                        <div class="row">
                            <div class="col-6">
                                <strong>Status:</strong> <span class="badge bg-${data.status === 'active' ? 'success' : 'secondary'}">${data.status}</span>
                            </div>
                            <div class="col-6">
                                <strong>Reputation:</strong> ${data.reputation_score}
                            </div>
                            <div class="col-6 mt-2">
                                <strong>Stakes:</strong> ${data.total_stakes}
                            </div>
                            <div class="col-6 mt-2">
                                <strong>Transactions:</strong> ${data.total_transactions}
                            </div>
                        </div>
                    `;
                }
            })
            .catch(error => {
                console.error('Error loading simulator node status:', error);
            });
    }
    
    function addLogEntry(message) {
        const log = document.getElementById('simulation-log');
        const timestamp = new Date().toLocaleTimeString();
        const entry = document.createElement('div');
        entry.innerHTML = `[${timestamp}] ${message}`;
        log.appendChild(entry);
        log.scrollTop = log.scrollHeight;
    }
});
</script>
{% endblock %}